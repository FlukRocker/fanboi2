{% from "partials/form.jinja2" import form_field, form_submit %}
{% from "partials/post.jinja2" import post_block %}
{% extends "topics/layout.jinja2" %}

{% block content %}
<div id="topics-show">
  {% for post in posts %}
    {{ post_block(post) }}
  {% endfor %}

  <ul>
    <li><a href="{{ request.resource_path(topic) }}">All posts</a></li>
    <li><a href="{{ request.resource_path(topic, "recent") }}">Recent posts</a></li>
    <li><a href="{{ request.resource_path(topic, "%s-" % topic.obj.post_count) }}">New since visit</a></li>
  </ul>

  {% if topic.obj.status == "open" %}
    <h3>Reply</h3>
    <form action="{{ request.resource_path(topic) }}" method="POST">
      {{ form.csrf_token }}
      {{ form_field(form.body) }}
      {{ form_submit("Post Reply") }}
    </form>
  {% elif topic.obj.status == "archived" %}
    <header>
      <h3>Post limit exceeded</h3>
      <p>Please start a new topic.</p>
    </header>
  {% elif topic.obj.status == "locked" %}
    <header>
      <h3>Topic locked</h3>
      <p>Topic has been locked by moderator.</p>
    </header>
  {% endif %}
</div>
{% endblock %}
